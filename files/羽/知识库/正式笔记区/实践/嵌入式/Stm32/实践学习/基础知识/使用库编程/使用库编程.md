# 使用库编程 Overview
 
```ccard
type: folder_brief_live
```
 
## cmsis标准

cmsis标准中最主要的是smsis核心层，其中包含有

- 内核函数层：访问内核寄存器相关的，这里由arm公司提供
- 设备外设访问层：提供了访问片上的核外外设相关的，这里是由芯片厂商提供

这就是架构

## 标准库介绍

要使用标准库，我认为得知道各个文件是什么意思。

就比如使用寄存器编程需要认识的3个重要文件，使用标准库编程把重要文件认识才通畅。

st标准库文件名字一般是STM32F4xx_DSP_StdPeriph_Lib_Vx.x.x，下面是三个文件夹，一个帮助文档。文件夹Libraries放着是驱动库的源代码和启动文件，Project是官方案例，Utilities是官方评估板的例程。

### 内核相关的文件

cmsis/cm3文件夹存放基础文件，必不可少的。

- Core_cm3.h 头文件里面实现了内核的寄存器映射，
- core_cm3.c 文件实现了一下操作内核外设寄存器的函数。

上面两个文件自建寄存器工程可能可以不需要（个人推测），但是使用标准库必须要使用。然后就是之前我做过笔记的启动文件和寄存器映射文件

- start_stm32f10x_xx.s 启动文件

补充关于启动文件的选择：我经常容易选错，特此批注

| 型号                                   | 特殊系列                                   |
| -------------------------------------- | ------------------------------------------ |
| ld：小容量，FLASH容量在16-32k之间      | cl：互联型，特指stm32f105xx和stm32f107xx系 |
| md：中容量，FLASH容量在64-128k之间     | vl：超值型，特质stm32f100xx系              |
| hd：大容量，FLASH容量在256-512k之间    |                                            |
| xl：超大容量，FLASH容量在512-1024k之间 |                                            |

- stm32f10x.h 这个头文件实现了片上外设的所以寄存器的映射
- system_stm32f10x.c，system_stm32f10x.h 该文件实现了STM32 的时钟配置

### 外设相关的文件

#### 标准库本体

文件存放于：Libraries\STM32F10x_StdPeriph_Driver下面

里面的两个文件夹里的文件是标准库的主体，这两个文件夹是互相对应的

- inc 是include的缩写，包含了各个外设的头文件
- src 是source的缩写，包含了库函数的源文件

#### 配套标准库使用的文件

- stm32f10x_it.c 这个文件是专门用来编写中断服务函数的，拿上！
- system_stm32f10x.c 这个文件包含了STM32 芯片上电后初始化系统时钟、扩展外部存储器用的
  函数，用于上电后初始化时钟。所以说可以通过操控这个文件来调控时钟，但是非必要还是不要，看上去很容易出问题！！
- stm32f10x_conf.h 这个是个配置文件类的，负责一次性包含需要的头文件，为了代码整洁。conf这个后缀也可以看出来



网上看到的也许有用大概率没用的官方资料汇总

## 官方资料

来自野火

- 《STM32F10X-中文参考手册》
  这个文件全方位介绍了STM32 芯片的各种片上外设，它把STM32 的时钟、存储
  器架构、及各种外设、寄存器都描述得清清楚楚。当我们对STM32 的外设感到
  困惑时，可查阅这个文档。以直接配置寄存器方式开发的话，查阅这个文档寄存
  器部分的频率会相当高，但这样效率太低了。
- 《STM32 规格书》
  本文档相当于STM32 的datasheet，包含了STM32 芯片所有的引脚功能说明及存
  储器架构、芯片外设架构说明。后面我们使用STM32 其它外设时，常常需要查
  找这个手册，了解外设对应到STM32 的哪个GPIO 引脚。
- 《Cortex™-M3 内核编程手册》
  本文档由ST 公司提供，主要讲解STM32 内核寄存器相关的说明，例如系统定时
  器、NVIC 等核外设的寄存器。这部分的内容是《STM32F10X-中文参考手册》没
  涉及到的内核部分的补充。相对来说，本文档虽然介绍了内核寄存器，但不如以
  下两个文档详细，要了解内核时，可作为以下两个手册的配合资料使用。
- 《Cortex-M3 权威指南》。
  这个手册是由ARM 公司提供的，它详细讲解了Cortex 内核的架构和特性，要深
  入了解Cortex-M 内核，这是首选，经典中的经典。这个手册也被翻译成中文，出
  版成书，我们配套的资料里面有提供中文版的电子版。
- 《stm32f10x_stdperiph_lib_um.chm》
  这个就是本章提到的库的帮助文档，在使用库函数时，我们最好通过查阅此文件
  来了解标准库提供了哪些外设、函数原型或库函数的调用的方法。也可以直接阅
  读源码里面的函数的函数说明。

P147

## 配套的知识
### 断言
？
不甚理解，以后再来
### 注释
在官方代码中，经常会看到那些特殊的注释，那些是名叫Doxygen的注释规范，
以后如果需要这种注释方法，可以额外的去学习。如果在工程文件中按照这种规范去注释，可
以使用 Doxygen 软件自动根据注释生成帮助文档。
![[Jetbrain技巧#自动生成注释]]
### 怎么防止头文件重复包含
可以在头文件的开头使用`ifndef`的关键字，来判断是否被定义。配套`endif`使用，如果没有被定义，程序将会执行`ifndef`和`endif`之间的代码